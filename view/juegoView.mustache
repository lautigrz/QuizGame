
{{#preguntas}}
<div class="container d-flex justify-content-center align-items-center" style="height: 90vh;">
    <div class="card text-center" style="width: 80%; max-width: 600px; border-radius: 20px; box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.2);">
       <div class="card-header text-white d-flex justify-content-between align-items-center" style="background-color:{{color}}; border-radius: 20px 20px 0 0;">
     <img src="{{icono}}" style="width: 45px; height: auto;">
    <h3 class="card-title preg">Pregunta</h3>
    <div id="number"></div>
</div>
       
        <div class="card-body" style="padding: 30px;">
      
            
            <p class="card-text h5 mb-4" style="font-weight: bold;">{{pregunta}}</p>
   
            <div class="d-grid gap-2 mx-auto" style="width: 100%;">
                {{#opciones}}
                <form action="/quizgame/juego/esCorrecta" method="GET">
                    <button type="submit" name="respuesta" class="btn btn-lg mt-2 boton-respuesta"
                            value="{{opcion}}"
                            style="background-color:{{color}}; color: white; border: none; border-radius: 10px; padding: 15px; width: 100%; white-space: nowrap; font-weight: bold;">
                        {{opcion}}
                    </button>
                </form>
                {{/opciones}}
            </div>
            {{/preguntas}}
        </div>
    </div>
</div>

<div class="modal fade" id="respuestaIncorrectaModal" tabindex="-1" aria-labelledby="respuestaIncorrectaLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="respuestaIncorrectaLabel">Puntaje final:{{puntaje}}</h5>
      </div>
      <div class="modal-body text-center">
        <p class="text-danger h5">Partina finalizada</p>
       <span>Tiempo restante:</span> <span id="number-modal"></span> 
        <p class="h5">Respuesta correcta: <span class="text-success">{{respuesta}}<span></p>
          <!-- Botón de Reportar que abre el modal -->
          <button type="button" class="btn btn-danger mt-4" style="width: 100%; padding: 10px; border-radius: 10px;" data-bs-toggle="modal" data-bs-target="#reportModal">
              Reportar Pregunta
          </button>
      </div>
      <div class="modal-footer">
        <a href="#" class="btn btn-secondary" onclick="cerrarYRedirigir('/quizgame/home/lobby')">Cerrar<a>
      </div>
    </div>
  </div>
</div>




<!-- Modal para reportar la pregunta -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reportModalLabel">Reportar Pregunta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="/quizgame/juego/reportePregunta" method="POST">
          <div class="mb-3">
            <label for="motivo" class="form-label">Motivo del Reporte</label>
            <textarea class="form-control" id="motivo" name="motivo" rows="3" required></textarea>
          </div>
          <input type="hidden" name="pregunta_id" value="{{pregunta_id}}"> <!-- ID de la pregunta si es necesario -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-danger">Enviar Reporte</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
var tiempo = parseInt(sessionStorage.getItem('tiempoRestante')) || 11; // Recupera el tiempo de sessionStorage o establece el valor inicial de 11.

document.addEventListener('DOMContentLoaded', function() {
    if (sessionStorage.getItem('mostrarModal') === 'true') {
        var respuestaIncorrectaModal = new bootstrap.Modal(document.getElementById('respuestaIncorrectaModal'), {
            keyboard: false,
            backdrop: 'static'
        });
        respuestaIncorrectaModal.show();

        actualizarTiempoEnModal(tiempo);

        sessionStorage.removeItem('mostrarModal');
    }

    // Iniciar el contador solo si no se ha indicado detenerlo
    if (sessionStorage.getItem('detenerContador') !== 'true') {
        iniciarContador();
    }
});

{{#respuesta_incorrecta}}
    sessionStorage.setItem('mostrarModal', 'true');
    sessionStorage.setItem('detenerContador', 'true');
{{/respuesta_incorrecta}}

function cerrarYRedirigir(url) {
    var modal = bootstrap.Modal.getInstance(document.getElementById('respuestaIncorrectaModal'));
    modal.hide();

    sessionStorage.removeItem('detenerContador');
    sessionStorage.removeItem('mostrarModal');
    window.location.href = url;
}

// Función para iniciar el contador
function iniciarContador() {
    var contadorElemento = document.getElementById('number');
    
    // Intervalo para actualizar el contador
    var intervalo = setInterval(function() {
        if (sessionStorage.getItem('detenerContador') === 'true') {
            clearInterval(intervalo);
            return;
        }

        tiempo--; // Disminuir el tiempo
        sessionStorage.setItem('tiempoRestante', tiempo); // Guardar el tiempo restante en sessionStorage
        contadorElemento.textContent = tiempo;
        actualizarTiempoEnModal(tiempo); // Actualizar el tiempo en el modal

        // Detener el contador si llega a 0
        if (tiempo === 0) {
            clearInterval(intervalo);
        }
    }, 1000);
}

// Función para actualizar el tiempo en el modal
function actualizarTiempoEnModal(tiempo) {
    var contadorModal = document.getElementById('number-modal');
    if (contadorModal) {
        contadorModal.textContent = tiempo;
    }
}
</script>





